#!/usr/bin/env node
//#region @backend
var fs = require('fs');
var path = require('path');
var ora = require('ora');
var spinner = ora();

global.spinner = spinner;
// if (!isNaN(process.ppid)) {
//   spinner.start();
// }

var pathToDistFolder = path.join(__dirname, '../dist');
var pathToBundleFolder = path.join(__dirname, '../bundle');

var pathToDistRun = path.join(__dirname, '../dist/start.backend.js');
var pathToBundletRun = path.join(__dirname, '../bundle/start.backend.js');

var distExist = fs.existsSync(pathToDistRun);
var bundleExist = fs.existsSync(pathToBundletRun);

var start;
global.tnp_normal_mode = true;

if (bundleExist && distExist) {
  if (fs.lstatSync(pathToDistFolder).mtimeMs > fs.lstatSync(pathToBundleFolder).mtimeMs) {
    console.log('- tnp dist -> becouse is newer -');
    global.tnp_out_folder = 'dist'
    start = require(pathToDistRun.replace(/\.js$/g, '')).start;
  } else {
    // console.log('- tnp bundle -> becouse is newer -')
    global.tnp_out_folder = 'bundle'
    start = require(pathToBundletRun.replace(/\.js$/g, '')).start;
  }
} else {
  if (bundleExist) {
    console.log('- tnp bundle -');
    global.tnp_out_folder = 'bundle'
    start = require(pathToBundletRun.replace(/\.js$/g, '')).start;
  } else {
    console.log('- tnp dist -');
    global.tnp_out_folder = 'dist'
    start = require(pathToDistRun.replace(/\.js$/g, '')).start;

  }
}


start(process.argv, spinner);
//#endregion
