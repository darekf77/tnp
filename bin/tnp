#!/usr/bin/env node
//#region @backend
var fs = require('fs')
var path = require('path')
var ora = require('ora')
var spinner = ora()
global.spinner = spinner;
if (!isNaN(process.ppid)) {
  spinner.start()
}

var pathToDistFolder = path.join(__dirname, '../dist');
var pathToBundleFolder = path.join(__dirname, '../bundle');

var pathToDistRun = path.join(__dirname, '../dist/start.js');
var pathToBundletRun = path.join(__dirname, '../bundle/start.js');

var distExist = fs.existsSync(pathToDistRun);
var bundleExist = fs.existsSync(pathToBundletRun);

var start;

global['tnp-normal-mode'] = true

if (bundleExist && distExist) {
  if (fs.lstatSync(pathToDistFolder).mtimeMs > fs.lstatSync(pathToBundleFolder).mtimeMs) {
    console.log('- tnp dist -> becouse is newer -')
    start = require(pathToDistRun.replace(/\.js$/g, '')).start;
  } else {
    // console.log('- tnp bundle -> becouse is newer -')
    start = require(pathToBundletRun.replace(/\.js$/g, '')).start;
  }
} else {
  if (bundleExist) {
    console.log('- tnp bundle -')
    start = require(pathToBundletRun.replace(/\.js$/g, '')).start;
  } else {
    // console.log('- tnp dist -');
    start = require(pathToDistRun.replace(/\.js$/g, '')).start;
  }
}


start(process.argv, spinner);
//#endregion
